/*!
* MediaElement.js
* HTML5 <video> and <audio> shim and player
* http://mediaelementjs.com/
*
* Creates a JavaScript object that mimics HTML5 MediaElement API
* for browsers that don't understand HTML5 or can't play the provided codec
* Can play MP4 (H.264), Ogg, WebM, FLV, WMV, WMA, ACC, and MP3
*
* Copyright 2010, John Dyer (http://johndyer.me)
* Dual licensed under the MIT or GPL Version 2 licenses.
*
*/
var mejs=mejs||{};mejs.version="2.1.2";mejs.meIndex=0;mejs.plugins={silverlight:[{version:[3,0],types:["video/mp4","video/m4v","video/mov","video/wmv","audio/wma","audio/m4a","audio/mp3","audio/wav","audio/mpeg"]}],flash:[{version:[9,0,124],types:["video/mp4","video/m4v","video/mov","video/flv","video/x-flv","audio/flv","audio/x-flv","audio/mp3","audio/m4a","audio/mpeg"]}]};mejs.Utility={encodeUrl:function(url){return encodeURIComponent(url);},escapeHTML:function(s){return s.split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;");},absolutizeUrl:function(url){var el=document.createElement("div");el.innerHTML='<a href="'+this.escapeHTML(url)+'">x</a>';return el.firstChild.href;},getScriptPath:function(scriptNames){var i=0,j,path="",name="",script,scripts=document.getElementsByTagName("script");for(;i<scripts.length;i++){script=scripts[i].src;for(j=0;j<scriptNames.length;j++){name=scriptNames[j];if(script.indexOf(name)>-1){path=script.substring(0,script.indexOf(name));break;}}if(path!==""){break;}}return path;},secondsToTimeCode:function(seconds){seconds=Math.round(seconds);var minutes=Math.floor(seconds/60);minutes=(minutes>=10)?minutes:"0"+minutes;seconds=Math.floor(seconds%60);seconds=(seconds>=10)?seconds:"0"+seconds;return minutes+":"+seconds;}};mejs.PluginDetector={hasPluginVersion:function(plugin,v){var pv=this.plugins[plugin];v[1]=v[1]||0;v[2]=v[2]||0;return(pv[0]>v[0]||(pv[0]==v[0]&&pv[1]>v[1])||(pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]))?true:false;},nav:window.navigator,ua:window.navigator.userAgent.toLowerCase(),plugins:[],addPlugin:function(p,pluginName,mimeType,activeX,axDetect){this.plugins[p]=this.detectPlugin(pluginName,mimeType,activeX,axDetect);},detectPlugin:function(pluginName,mimeType,activeX,axDetect){var version=[0,0,0],description,i,ax;if(typeof(this.nav.plugins)!="undefined"&&typeof this.nav.plugins[pluginName]=="object"){description=this.nav.plugins[pluginName].description;if(description&&!(typeof this.nav.mimeTypes!="undefined"&&this.nav.mimeTypes[mimeType]&&!this.nav.mimeTypes[mimeType].enabledPlugin)){version=description.replace(pluginName,"").replace(/^\s+/,"").replace(/\sr/gi,".").split(".");for(i=0;i<version.length;i++){version[i]=parseInt(version[i].match(/\d+/),10);}}}else{if(typeof(window.ActiveXObject)!="undefined"){try{ax=new ActiveXObject(activeX);if(ax){version=axDetect(ax);}}catch(e){}}}return version;}};mejs.PluginDetector.addPlugin("flash","Shockwave Flash","application/x-shockwave-flash","ShockwaveFlash.ShockwaveFlash",function(ax){var version=[],d=ax.GetVariable("$version");if(d){d=d.split(" ")[1].split(",");version=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)];}return version;});mejs.PluginDetector.addPlugin("silverlight","Silverlight Plug-In","application/x-silverlight-2","AgControl.AgControl",function(ax){var v=[0,0,0,0],loopMatch=function(ax,v,i,n){while(ax.isVersionSupported(v[0]+"."+v[1]+"."+v[2]+"."+v[3])){v[i]+=n;}v[i]-=n;};loopMatch(ax,v,0,1);loopMatch(ax,v,1,1);loopMatch(ax,v,2,10000);loopMatch(ax,v,2,1000);loopMatch(ax,v,2,100);loopMatch(ax,v,2,10);loopMatch(ax,v,2,1);loopMatch(ax,v,3,1);return v;});if(mejs.PluginDetector.ua.match(/android 2\.[12]/)!==null){HTMLMediaElement.canPlayType=function(type){return(type.match(/video\/(mp4|m4v)/gi)!==null)?"probably":"";};}mejs.MediaFeatures={init:function(){var nav=mejs.PluginDetector.nav,ua=mejs.PluginDetector.ua.toLowerCase(),i,v,html5Elements=["source","track","audio","video"];this.isiPad=(ua.match(/ipad/i)!==null);this.isiPhone=(ua.match(/iphone/i)!==null);this.isAndroid=(ua.match(/android/i)!==null);this.isIE=(nav.appName.toLowerCase().indexOf("microsoft")!=-1);this.isChrome=(ua.match(/chrome/gi)!==null);for(i=0;i<html5Elements.length;i++){v=document.createElement(html5Elements[i]);}this.hasNativeFullScreen=(typeof v.webkitEnterFullScreen!=="undefined");if(this.isChrome){this.hasNativeFullScreen=false;}}};mejs.MediaFeatures.init();mejs.HtmlMediaElement={pluginType:"native",isFullScreen:false,setCurrentTime:function(time){this.currentTime=time;},setMuted:function(muted){this.muted=muted;},setVolume:function(volume){this.volume=volume;},stop:function(){this.pause();},setSrc:function(url){if(typeof url=="string"){this.src=url;}else{var i,media;for(i=0;i<url.length;i++){media=url[i];if(this.canPlayType(media.type)){this.src=media.src;}}}},setVideoSize:function(width,height){this.width=width;this.height=height;}};mejs.PluginMediaElement=function(pluginid,pluginType,mediaUrl){this.id=pluginid;this.pluginType=pluginType;this.src=mediaUrl;this.events={};};mejs.PluginMediaElement.prototype={pluginElement:null,pluginType:"",isFullScreen:false,playbackRate:-1,defaultPlaybackRate:-1,seekable:[],played:[],paused:true,ended:false,seeking:false,duration:0,error:null,muted:false,volume:1,currentTime:0,play:function(){if(this.pluginApi!=null){this.pluginApi.playMedia();this.paused=false;}},load:function(){if(this.pluginApi!=null){this.pluginApi.loadMedia();this.paused=false;}},pause:function(){if(this.pluginApi!=null){this.pluginApi.pauseMedia();this.paused=true;}},stop:function(){if(this.pluginApi!=null){this.pluginApi.stopMedia();this.paused=true;}},canPlayType:function(type){var i,j,pluginInfo,pluginVersions=mejs.plugins[this.pluginType];for(i=0;i<pluginVersions.length;i++){pluginInfo=pluginVersions[i];if(mejs.PluginDetector.hasPluginVersion(this.pluginType,pluginInfo.version)){for(j=0;j<pluginInfo.types.length;j++){if(type==pluginInfo.types[j]){return true;}}}}return false;},setSrc:function(url){if(typeof url=="string"){this.pluginApi.setSrc(mejs.Utility.absolutizeUrl(url));this.src=mejs.Utility.absolutizeUrl(url);}else{var i,media;for(i=0;i<url.length;i++){media=url[i];if(this.canPlayType(media.type)){this.pluginApi.setSrc(mejs.Utility.absolutizeUrl(media.src));this.src=mejs.Utility.absolutizeUrl(url);}}}},setCurrentTime:function(time){if(this.pluginApi!=null){this.pluginApi.setCurrentTime(time);this.currentTime=time;}},setVolume:function(volume){if(this.pluginApi!=null){this.pluginApi.setVolume(volume);this.volume=volume;}},setMuted:function(muted){if(this.pluginApi!=null){this.pluginApi.setMuted(muted);this.muted=muted;}},setVideoSize:function(width,height){if(this.pluginElement.style){this.pluginElement.style.width=width+"px";this.pluginElement.style.height=height+"px";}if(this.pluginApi!=null){this.pluginApi.setVideoSize(width,height);}},setFullscreen:function(fullscreen){if(this.pluginApi!=null){this.pluginApi.setFullscreen(fullscreen);}},addEventListener:function(eventName,callback,bubble){this.events[eventName]=this.events[eventName]||[];this.events[eventName].push(callback);},removeEventListener:function(eventName,callback){if(!eventName){this.events={};return true;}var callbacks=this.events[eventName];if(!callbacks){return true;}if(!callback){this.events[eventName]=[];return true;}for(i=0;i<callbacks.length;i++){if(callbacks[i]===callback){this.events[eventName].splice(i,1);return true;}}return false;},dispatchEvent:function(eventName){var i,args,callbacks=this.events[eventName];if(callbacks){args=Array.prototype.slice.call(arguments,1);for(i=0;i<callbacks.length;i++){callbacks[i].apply(null,args);}}}};mejs.MediaPluginBridge={pluginMediaElements:{},htmlMediaElements:{},registerPluginElement:function(id,pluginMediaElement,htmlMediaElement){this.pluginMediaElements[id]=pluginMediaElement;this.htmlMediaElements[id]=htmlMediaElement;},initPlugin:function(id){var pluginMediaElement=this.pluginMediaElements[id],htmlMediaElement=this.htmlMediaElements[id];switch(pluginMediaElement.pluginType){case"flash":pluginMediaElement.pluginElement=pluginMediaElement.pluginApi=document.getElementById(id);break;case"silverlight":pluginMediaElement.pluginElement=document.getElementById(pluginMediaElement.id);pluginMediaElement.pluginApi=pluginMediaElement.pluginElement.Content.MediaElementJS;break;}if(pluginMediaElement.pluginApi!=null&&pluginMediaElement.success){pluginMediaElement.success(pluginMediaElement,htmlMediaElement);}},fireEvent:function(id,eventName,values){var e,i,bufferedTime,pluginMediaElement=this.pluginMediaElements[id];pluginMediaElement.ended=false;pluginMediaElement.paused=true;e={type:eventName,target:pluginMediaElement};for(i in values){pluginMediaElement[i]=values[i];e[i]=values[i];}bufferedTime=values.bufferedTime||0;e.target.buffered=e.buffered={start:function(index){return 0;},end:function(index){return bufferedTime;},length:1};pluginMediaElement.dispatchEvent(e.type,e);}};mejs.MediaElementDefaults={mode:"auto",plugins:["flash","silverlight"],enablePluginDebug:false,type:"",pluginPath:mejs.Utility.getScriptPath(["mediaelement.js","mediaelement.min.js","mediaelement-and-player.js","mediaelement-and-player.min.js"]),flashName:"flashmediaelement.swf",enablePluginSmoothing:false,silverlightName:"silverlightmediaelement.xap",defaultVideoWidth:480,defaultVideoHeight:270,pluginWidth:-1,pluginHeight:-1,timerRate:250,success:function(){},error:function(){}};mejs.MediaElement=function(el,o){return mejs.HtmlMediaElementShim.create(el,o);};mejs.HtmlMediaElementShim={create:function(el,o){var options=mejs.MediaElementDefaults,htmlMediaElement=(typeof(el)=="string")?document.getElementById(el):el,isVideo=(htmlMediaElement.tagName.toLowerCase()=="video"),supportsMediaTag=(typeof(htmlMediaElement.canPlayType)!="undefined"),playback={method:"",url:""},poster=htmlMediaElement.getAttribute("poster"),autoplay=htmlMediaElement.getAttribute("autoplay"),preload=htmlMediaElement.getAttribute("preload"),controls=htmlMediaElement.getAttribute("controls"),prop;for(prop in o){options[prop]=o[prop];}poster=(typeof poster=="undefined"||poster===null)?"":poster;preload=(typeof preload=="undefined"||preload===null||preload==="false")?"none":preload;autoplay=!(typeof autoplay=="undefined"||autoplay===null||autoplay==="false");controls=!(typeof controls=="undefined"||controls===null||controls==="false");playback=this.determinePlayback(htmlMediaElement,options,isVideo,supportsMediaTag);if(playback.method=="native"){return this.updateNative(htmlMediaElement,options,autoplay,preload,playback);}else{if(playback.method!==""){return this.createPlugin(htmlMediaElement,options,isVideo,playback.method,(playback.url!==null)?mejs.Utility.absolutizeUrl(playback.url):"",poster,autoplay,preload,controls);}else{this.createErrorMessage(htmlMediaElement,options,(playback.url!==null)?mejs.Utility.absolutizeUrl(playback.url):"",poster);}}},determinePlayback:function(htmlMediaElement,options,isVideo,supportsMediaTag){var mediaFiles=[],i,j,k,l,n,type,result={method:"",url:""},src=htmlMediaElement.getAttribute("src"),pluginName,pluginVersions,pluginInfo;if(typeof(options.type)!="undefined"&&options.type!==""){mediaFiles.push({type:options.type,url:null});}else{if(src!="undefined"&&src!==null){type=this.checkType(src,htmlMediaElement.getAttribute("type"),isVideo);mediaFiles.push({type:type,url:src});}else{for(i=0;i<htmlMediaElement.childNodes.length;i++){n=htmlMediaElement.childNodes[i];if(n.nodeType==1&&n.tagName.toLowerCase()=="source"){src=n.getAttribute("src");type=this.checkType(src,n.getAttribute("type"),isVideo);mediaFiles.push({type:type,url:src});}}}}if(supportsMediaTag&&(options.mode==="auto"||options.mode==="native")){for(i=0;i<mediaFiles.length;i++){if(htmlMediaElement.canPlayType(mediaFiles[i].type).replace(/no/,"")!==""||htmlMediaElement.canPlayType(mediaFiles[i].type.replace(/mp3/,"mpeg")).replace(/no/,"")!==""){result.method="native";result.url=mediaFiles[i].url;return result;}}}if(options.mode==="auto"||options.mode==="shim"){for(i=0;i<mediaFiles.length;i++){type=mediaFiles[i].type;for(j=0;j<options.plugins.length;j++){pluginName=options.plugins[j];pluginVersions=mejs.plugins[pluginName];for(k=0;k<pluginVersions.length;k++){pluginInfo=pluginVersions[k];if(mejs.PluginDetector.hasPluginVersion(pluginName,pluginInfo.version)){for(l=0;l<pluginInfo.types.length;l++){if(type==pluginInfo.types[l]){result.method=pluginName;result.url=mediaFiles[i].url;return result;}}}}}}}if(result.method===""){result.url=mediaFiles[0].url;}return result;},checkType:function(url,type,isVideo){var ext;if(url&&!type){ext=url.substring(url.lastIndexOf(".")+1);return((isVideo)?"video":"audio")+"/"+ext;}else{if(type&&~type.indexOf(";")){return type.substr(0,type.indexOf(";"));}else{return type;}}},createErrorMessage:function(htmlMediaElement,options,downloadUrl,poster){var errorContainer=document.createElement("div");errorContainer.className="me-cannotplay";try{errorContainer.style.width=htmlMediaElement.width+"px";errorContainer.style.height=htmlMediaElement.height+"px";}catch(e){}errorContainer.innerHTML=(poster!=="")?'<a href="'+downloadUrl+'"><img src="'+poster+'" /></a>':'<a href="'+downloadUrl+'"><span>Download File</span></a>';htmlMediaElement.parentNode.insertBefore(errorContainer,htmlMediaElement);htmlMediaElement.style.display="none";options.error(htmlMediaElement);},createPlugin:function(htmlMediaElement,options,isVideo,pluginType,mediaUrl,poster,autoplay,preload,controls){var width=1,height=1,pluginid="me_"+pluginType+"_"+(mejs.meIndex++),pluginMediaElement=new mejs.PluginMediaElement(pluginid,pluginType,mediaUrl),container=document.createElement("div"),specialIEContainer,node,initVars;node=htmlMediaElement.parentNode;while(node!==null&&node.tagName.toLowerCase()!="body"){if(node.parentNode.tagName.toLowerCase()=="p"){node.parentNode.parentNode.insertBefore(node,node.parentNode);break;}node=node.parentNode;}if(isVideo){width=(options.videoWidth>0)?options.videoWidth:(htmlMediaElement.getAttribute("width")!==null)?htmlMediaElement.getAttribute("width"):options.defaultVideoWidth;height=(options.videoHeight>0)?options.videoHeight:(htmlMediaElement.getAttribute("height")!==null)?htmlMediaElement.getAttribute("height"):options.defaultVideoHeight;}else{if(options.enablePluginDebug){width=320;height=240;}}pluginMediaElement.success=options.success;mejs.MediaPluginBridge.registerPluginElement(pluginid,pluginMediaElement,htmlMediaElement);container.className="me-plugin";htmlMediaElement.parentNode.insertBefore(container,htmlMediaElement);initVars=["id="+pluginid,"isvideo="+((isVideo)?"true":"false"),"autoplay="+((autoplay)?"true":"false"),"preload="+preload,"width="+width,"timerrate="+options.timerRate,"height="+height];if(mediaUrl!==null){if(pluginType=="flash"){initVars.push("file="+mejs.Utility.encodeUrl(mediaUrl));}else{initVars.push("file="+mediaUrl);}}if(options.enablePluginDebug){initVars.push("debug=true");}if(options.enablePluginSmoothing){initVars.push("smoothing=true");}if(controls){initVars.push("controls=true");}switch(pluginType){case"silverlight":container.innerHTML='<object data="data:application/x-silverlight-2," type="application/x-silverlight-2" id="'+pluginid+'" name="'+pluginid+'" width="'+width+'" height="'+height+'"><param name="initParams" value="'+initVars.join(",")+'" /><param name="windowless" value="true" /><param name="background" value="black" /><param name="minRuntimeVersion" value="3.0.0.0" /><param name="autoUpgrade" value="true" /><param name="source" value="'+options.pluginPath+options.silverlightName+'" /></object>';break;case"flash":if(mejs.MediaFeatures.isIE){specialIEContainer=document.createElement("div");container.appendChild(specialIEContainer);specialIEContainer.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab" id="'+pluginid+'" width="'+width+'" height="'+height+'"><param name="movie" value="'+options.pluginPath+options.flashName+"?x="+(new Date())+'" /><param name="flashvars" value="'+initVars.join("&amp;")+'" /><param name="quality" value="high" /><param name="bgcolor" value="#000000" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="true" /></object>';}else{container.innerHTML='<embed id="'+pluginid+'" name="'+pluginid+'" play="true" loop="false" quality="high" bgcolor="#000000" wmode="transparent" allowScriptAccess="always" allowFullScreen="true" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+options.pluginPath+options.flashName+'" flashvars="'+initVars.join("&")+'" width="'+width+'" height="'+height+'"></embed>';}break;}htmlMediaElement.style.display="none";return pluginMediaElement;},updateNative:function(htmlMediaElement,options,autoplay,preload,playback){for(var m in mejs.HtmlMediaElement){htmlMediaElement[m]=mejs.HtmlMediaElement[m];}if(mejs.MediaFeatures.isChrome){if(preload==="none"&&!autoplay){htmlMediaElement.src="";htmlMediaElement.load();htmlMediaElement.canceledPreload=true;htmlMediaElement.addEventListener("play",function(){if(htmlMediaElement.canceledPreload){htmlMediaElement.src=playback.url;htmlMediaElement.load();htmlMediaElement.play();htmlMediaElement.canceledPreload=false;}},false);}else{if(autoplay){htmlMediaElement.load();htmlMediaElement.play();}}}options.success(htmlMediaElement,htmlMediaElement);return htmlMediaElement;}};window.mejs=mejs;window.MediaElement=mejs.MediaElement;