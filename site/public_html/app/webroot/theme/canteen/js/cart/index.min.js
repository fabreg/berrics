$(document).ready(function(){$("div[hash]").click(function(){var id=$(this).attr("hash");document.location.href="/canteen/cart/remove/"+id;});$("#same-as-shipping-check").click(function(){toggleBilling($("#same-as-shipping-check"));});toggleBilling($("#same-as-shipping-check"));$("select[name*='[country_code]'],select[name*='[state]'],select[name='data[CanteenOrder][shipping_method]']").bind("change",function(e){calculateCart();});$("#CanteenOrderPostal").bind("keyup",function(e){});$(".form-error").focus(function(){$(this).removeClass("form-error");});$(".checkout-form form").submit(function(){$("#checkout-submit").attr({disabled:"disabled",value:"PROCESSING ORDER"});});if($("#canteen-cart #flashMessage").length>0){$("#canteen-cart #flashMessage").removeClass("alert-info").addClass("alert-error");}});function calculateCart(){$("#checkout-form").ajaxSubmit({url:"/canteen/cart/calc_cart",dataType:"json",success:function(d){$("#sub-total-dd").html(d.CanteenOrder.sub_total);$("#tax-total-dd").html(d.CanteenOrder.tax_total);$("#shipping-total-dd").html(d.CanteenOrder.shipping_total);$("#grand-total-dd,#grand-total span").html(d.CanteenOrder.grand_total);}});}function toggleBilling(check){if($(check).is(":checked")){$("#billing-form").slideUp();}else{$("#billing-form").slideDown();}}function validateTextField(id){var ele=$("#"+id);var val=$(ele).val();var parent=$(ele).parent();if(val.length<2){if(!$(parent).hasClass("bad")){$(parent).switchClass("good","bad","fast");}}else{if(!$(parent).hasClass("good")){$(parent).switchClass("bad","good","fast");}}}function validateSelect(id){}function validateEmail(id){var reg=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;var ele=$("#"+id);var val=$(ele).val();var parent=$(ele).parent();if(reg.test(val)==false){if(!$(parent).hasClass("bad")){$(parent).addClass("bad","fast");$(parent).removeClass("good");}}else{if(!$(parent).hasClass("good")){$(parent).addClass("good","fast");$(parent).removeClass("bad");}}}function validateExp(){var pMonth=$("#CardDataExpMonth").parent();var pYear=$("#CardDataExpYear").parent();var month=$("#CardDataExpMonth").val();var year="20"+$("#CardDataExpYear").val();var d=new Date();var t_month=d.getMonth();var t_year=d.getFullYear();var valid=false;if(((Number(year)==t_year)&&(Number(month)>=(t_month+1)))||(Number(year)>t_year)){valid=true;}if(!valid){$(pMonth).switchClass("good","bad","fast");$(pYear).switchClass("good","bad","fast");}else{$(pMonth).switchClass("bad","good","fast");$(pYear).switchClass("bad","good","fast");}}function Mod10(id){var ele=$("#"+id);var val=$(ele).val();var ccNumb=val.replace(/\s+/g,"");var parent=$(ele).parent();var valid="0123456789";var len=ccNumb.length;var iCCN=parseInt(ccNumb);var sCCN=ccNumb.toString();sCCN=sCCN.replace(/^s+|s+$/g,"");var iTotal=0;var bNum=true;var bResult=false;var temp;var calc;for(var j=0;j<len;j++){temp=""+sCCN.substring(j,j+1);if(valid.indexOf(temp)=="-1"){bNum=false;}}if(!bNum){bResult=false;}if((len==0)&&(bResult)){bResult=false;}else{if(len>=15){for(var i=len;i>0;i--){calc=parseInt(iCCN)%10;calc=parseInt(calc);iTotal+=calc;i--;iCCN=iCCN/10;calc=parseInt(iCCN)%10;calc=calc*2;switch(calc){case 10:calc=1;break;case 12:calc=3;break;case 14:calc=5;break;case 16:calc=7;break;case 18:calc=9;break;default:calc=calc;}iCCN=iCCN/10;iTotal+=calc;}if((iTotal%10)==0){bResult=true;}else{bResult=false;}}}if(!bResult){if(!$(parent).hasClass("bad")){$(parent).addClass("bad");$(parent).removeClass("good");}}else{if(!$(parent).hasClass("good")){$(parent).addClass("good");$(parent).removeClass("bad");}}}function objectToString(o){var parse=function(_o){var a=[],t;for(var p in _o){if(_o.hasOwnProperty(p)){t=_o[p];if(t&&typeof t=="object"){a[a.length]=p+":{ "+arguments.callee(t).join(", ")+"}";}else{if(typeof t=="string"){a[a.length]=[p+': "'+t.toString()+'"'];}else{a[a.length]=[p+": "+t.toString()];}}}}return a;};return"{"+parse(o).join(", ")+"}";}